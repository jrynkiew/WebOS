"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var protoLoader = _interopRequireWildcard(require("@grpc/proto-loader"));

var _grpc = _interopRequireDefault(require("grpc"));

var _util = require("util");

var _rootCerts = require("./root-certs");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const packageDefinition = protoLoader.loadSync(`${__dirname}/../../proto/api/api.proto`, {
  keepCase: true,
  longs: String,
  enums: String,
  defaults: true,
  oneofs: true,
  includeDirs: [`${__dirname}/../../`]
});

const iotexapi = _grpc.default.loadPackageDefinition(packageDefinition).iotexapi;

class RpcMethod {
  constructor(hostname, options = {}) {
    _defineProperty(this, "client", void 0);

    _defineProperty(this, "timeout", void 0);

    _defineProperty(this, "apiToken", void 0);

    _defineProperty(this, "credentials", void 0);

    const normalizedHostname = String(hostname).replace(/^(http:\/\/|https:\/\/)/, "");

    if (hostname.startsWith("https://")) {
      options.enableSsl = true;
    }

    this.credentials = options && options.enableSsl ? _grpc.default.credentials.createSsl(Buffer.from(_rootCerts.ROOT_CERTS)) : _grpc.default.credentials.createInsecure(); // @ts-ignore

    this.client = new iotexapi.APIService(normalizedHostname, this.credentials, null);
    this.timeout = options.timeout || 300000;
    this.apiToken = options.apiToken;
  }

  setProvider(provider) {
    if (typeof provider === "string") {
      const normalizedHostname = String(provider).replace(/^(http:\/\/|https:\/\/)/, "");
      this.credentials = provider.startsWith("https://") ? _grpc.default.credentials.createSsl(Buffer.from(_rootCerts.ROOT_CERTS)) : _grpc.default.credentials.createInsecure(); // @ts-ignore

      this.client = new iotexapi.APIService(normalizedHostname, this.credentials, null);
    } else {
      const origin = provider;
      this.client = origin.client;
    }
  }

  getDeadline() {
    return new Date(Date.now() + this.timeout).getTime();
  }

  getMetadata() {
    const metadata = new _grpc.default.Metadata();
    metadata.add("deadline", this.getDeadline().toString());

    if (this.apiToken) {
      metadata.add("authorization", `bearer ${this.apiToken}`);
    }

    return metadata;
  }

  async getAccount(req) {
    const getAccount = (0, _util.promisify)(this.client.getAccount.bind(this.client)); // @ts-ignore

    return getAccount(req, this.getMetadata());
  }

  async getBlockMetas(req) {
    const getBlockMetas = (0, _util.promisify)(this.client.getBlockMetas.bind(this.client)); // @ts-ignore

    return getBlockMetas(req, this.getMetadata());
  }

  async getChainMeta(req) {
    const getChainMeta = (0, _util.promisify)(this.client.getChainMeta.bind(this.client)); // @ts-ignore

    return getChainMeta(req, this.getMetadata());
  }

  async getServerMeta(req) {
    const getServerMeta = (0, _util.promisify)(this.client.getServerMeta.bind(this.client)); // @ts-ignore

    return getServerMeta(req, this.getMetadata());
  }

  async getActions(req) {
    const getActions = (0, _util.promisify)(this.client.getActions.bind(this.client)); // @ts-ignore

    return getActions(req, this.getMetadata());
  }

  async suggestGasPrice(req) {
    const suggestGasPrice = (0, _util.promisify)(this.client.suggestGasPrice.bind(this.client)); // @ts-ignore

    return suggestGasPrice(req, this.getMetadata());
  }

  async getReceiptByAction(req) {
    const getReceiptByAction = (0, _util.promisify)(this.client.getReceiptByAction.bind(this.client)); // @ts-ignore

    return getReceiptByAction(req, this.getMetadata());
  }

  async readContract(req) {
    const readContract = (0, _util.promisify)(this.client.readContract.bind(this.client)); // @ts-ignore

    return readContract(req, this.getMetadata());
  }

  async sendAction(req) {
    const sendAction = (0, _util.promisify)(this.client.sendAction.bind(this.client)); // @ts-ignore

    return sendAction(req, this.getMetadata());
  }

  async estimateGasForAction(req) {
    const estimateGasForAction = (0, _util.promisify)(this.client.estimateGasForAction.bind(this.client)); // @ts-ignore

    return estimateGasForAction(req, this.getMetadata());
  }

  async readState(req) {
    const readState = (0, _util.promisify)(this.client.readState.bind(this.client)); // @ts-ignore

    return readState(req, this.getMetadata());
  }

  async getEpochMeta(req) {
    const getEpochMeta = (0, _util.promisify)(this.client.getEpochMeta.bind(this.client)); // @ts-ignore

    return getEpochMeta(req, this.getMetadata());
  }

  async getLogs(req) {
    const getLogs = (0, _util.promisify)(this.client.getLogs.bind(this.client)); // @ts-ignore

    return getLogs(req, this.getMetadata());
  }

  async estimateActionGasConsumption(req) {
    const estimateActionGasConsumption = (0, _util.promisify)(this.client.estimateActionGasConsumption.bind(this.client)); // @ts-ignore

    return estimateActionGasConsumption(req, this.getMetadata());
  }

  streamBlocks(req) {
    // @ts-ignore
    return this.client.streamBlocks(req, this.getMetadata());
  }

  streamLogs(req) {
    // @ts-ignore
    return this.client.streamLogs(req, this.getMetadata());
  }

}

exports.default = RpcMethod;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ycGMtbWV0aG9kL25vZGUtcnBjLW1ldGhvZC50cyJdLCJuYW1lcyI6WyJwYWNrYWdlRGVmaW5pdGlvbiIsInByb3RvTG9hZGVyIiwibG9hZFN5bmMiLCJfX2Rpcm5hbWUiLCJrZWVwQ2FzZSIsImxvbmdzIiwiU3RyaW5nIiwiZW51bXMiLCJkZWZhdWx0cyIsIm9uZW9mcyIsImluY2x1ZGVEaXJzIiwiaW90ZXhhcGkiLCJncnBjIiwibG9hZFBhY2thZ2VEZWZpbml0aW9uIiwiUnBjTWV0aG9kIiwiY29uc3RydWN0b3IiLCJob3N0bmFtZSIsIm9wdGlvbnMiLCJub3JtYWxpemVkSG9zdG5hbWUiLCJyZXBsYWNlIiwic3RhcnRzV2l0aCIsImVuYWJsZVNzbCIsImNyZWRlbnRpYWxzIiwiY3JlYXRlU3NsIiwiQnVmZmVyIiwiZnJvbSIsIlJPT1RfQ0VSVFMiLCJjcmVhdGVJbnNlY3VyZSIsImNsaWVudCIsIkFQSVNlcnZpY2UiLCJ0aW1lb3V0IiwiYXBpVG9rZW4iLCJzZXRQcm92aWRlciIsInByb3ZpZGVyIiwib3JpZ2luIiwiZ2V0RGVhZGxpbmUiLCJEYXRlIiwibm93IiwiZ2V0VGltZSIsImdldE1ldGFkYXRhIiwibWV0YWRhdGEiLCJNZXRhZGF0YSIsImFkZCIsInRvU3RyaW5nIiwiZ2V0QWNjb3VudCIsInJlcSIsImJpbmQiLCJnZXRCbG9ja01ldGFzIiwiZ2V0Q2hhaW5NZXRhIiwiZ2V0U2VydmVyTWV0YSIsImdldEFjdGlvbnMiLCJzdWdnZXN0R2FzUHJpY2UiLCJnZXRSZWNlaXB0QnlBY3Rpb24iLCJyZWFkQ29udHJhY3QiLCJzZW5kQWN0aW9uIiwiZXN0aW1hdGVHYXNGb3JBY3Rpb24iLCJyZWFkU3RhdGUiLCJnZXRFcG9jaE1ldGEiLCJnZXRMb2dzIiwiZXN0aW1hdGVBY3Rpb25HYXNDb25zdW1wdGlvbiIsInN0cmVhbUJsb2NrcyIsInN0cmVhbUxvZ3MiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7OztBQXNDQSxNQUFNQSxpQkFBaUIsR0FBR0MsV0FBVyxDQUFDQyxRQUFaLENBQ3ZCLEdBQUVDLFNBQVUsNEJBRFcsRUFFeEI7QUFDRUMsRUFBQUEsUUFBUSxFQUFFLElBRFo7QUFFRUMsRUFBQUEsS0FBSyxFQUFFQyxNQUZUO0FBR0VDLEVBQUFBLEtBQUssRUFBRUQsTUFIVDtBQUlFRSxFQUFBQSxRQUFRLEVBQUUsSUFKWjtBQUtFQyxFQUFBQSxNQUFNLEVBQUUsSUFMVjtBQU1FQyxFQUFBQSxXQUFXLEVBQUUsQ0FBRSxHQUFFUCxTQUFVLFNBQWQ7QUFOZixDQUZ3QixDQUExQjs7QUFXQSxNQUFNUSxRQUFRLEdBQUdDLGNBQUtDLHFCQUFMLENBQTJCYixpQkFBM0IsRUFBOENXLFFBQS9EOztBQVFlLE1BQU1HLFNBQU4sQ0FBc0M7QUFNbkRDLEVBQUFBLFdBQVcsQ0FBQ0MsUUFBRCxFQUFtQkMsT0FBYSxHQUFHLEVBQW5DLEVBQXVDO0FBQUE7O0FBQUE7O0FBQUE7O0FBQUE7O0FBQ2hELFVBQU1DLGtCQUFrQixHQUFHWixNQUFNLENBQUNVLFFBQUQsQ0FBTixDQUFpQkcsT0FBakIsQ0FDekIseUJBRHlCLEVBRXpCLEVBRnlCLENBQTNCOztBQUlBLFFBQUlILFFBQVEsQ0FBQ0ksVUFBVCxDQUFvQixVQUFwQixDQUFKLEVBQXFDO0FBQ25DSCxNQUFBQSxPQUFPLENBQUNJLFNBQVIsR0FBb0IsSUFBcEI7QUFDRDs7QUFDRCxTQUFLQyxXQUFMLEdBQ0VMLE9BQU8sSUFBSUEsT0FBTyxDQUFDSSxTQUFuQixHQUNJVCxjQUFLVSxXQUFMLENBQWlCQyxTQUFqQixDQUEyQkMsTUFBTSxDQUFDQyxJQUFQLENBQVlDLHFCQUFaLENBQTNCLENBREosR0FFSWQsY0FBS1UsV0FBTCxDQUFpQkssY0FBakIsRUFITixDQVJnRCxDQVloRDs7QUFDQSxTQUFLQyxNQUFMLEdBQWMsSUFBSWpCLFFBQVEsQ0FBQ2tCLFVBQWIsQ0FDWlgsa0JBRFksRUFFWixLQUFLSSxXQUZPLEVBR1osSUFIWSxDQUFkO0FBS0EsU0FBS1EsT0FBTCxHQUFlYixPQUFPLENBQUNhLE9BQVIsSUFBbUIsTUFBbEM7QUFDQSxTQUFLQyxRQUFMLEdBQWdCZCxPQUFPLENBQUNjLFFBQXhCO0FBQ0Q7O0FBRU1DLEVBQUFBLFdBQVcsQ0FBQ0MsUUFBRCxFQUFzQztBQUN0RCxRQUFJLE9BQU9BLFFBQVAsS0FBb0IsUUFBeEIsRUFBa0M7QUFDaEMsWUFBTWYsa0JBQWtCLEdBQUdaLE1BQU0sQ0FBQzJCLFFBQUQsQ0FBTixDQUFpQmQsT0FBakIsQ0FDekIseUJBRHlCLEVBRXpCLEVBRnlCLENBQTNCO0FBSUEsV0FBS0csV0FBTCxHQUFtQlcsUUFBUSxDQUFDYixVQUFULENBQW9CLFVBQXBCLElBQ2ZSLGNBQUtVLFdBQUwsQ0FBaUJDLFNBQWpCLENBQTJCQyxNQUFNLENBQUNDLElBQVAsQ0FBWUMscUJBQVosQ0FBM0IsQ0FEZSxHQUVmZCxjQUFLVSxXQUFMLENBQWlCSyxjQUFqQixFQUZKLENBTGdDLENBUWhDOztBQUNBLFdBQUtDLE1BQUwsR0FBYyxJQUFJakIsUUFBUSxDQUFDa0IsVUFBYixDQUNaWCxrQkFEWSxFQUVaLEtBQUtJLFdBRk8sRUFHWixJQUhZLENBQWQ7QUFLRCxLQWRELE1BY087QUFDTCxZQUFNWSxNQUFNLEdBQUdELFFBQWY7QUFDQSxXQUFLTCxNQUFMLEdBQWNNLE1BQU0sQ0FBQ04sTUFBckI7QUFDRDtBQUNGOztBQUVNTyxFQUFBQSxXQUFXLEdBQVc7QUFDM0IsV0FBTyxJQUFJQyxJQUFKLENBQVNBLElBQUksQ0FBQ0MsR0FBTCxLQUFhLEtBQUtQLE9BQTNCLEVBQW9DUSxPQUFwQyxFQUFQO0FBQ0Q7O0FBRU9DLEVBQUFBLFdBQVcsR0FBa0I7QUFDbkMsVUFBTUMsUUFBUSxHQUFHLElBQUk1QixjQUFLNkIsUUFBVCxFQUFqQjtBQUNBRCxJQUFBQSxRQUFRLENBQUNFLEdBQVQsQ0FBYSxVQUFiLEVBQXlCLEtBQUtQLFdBQUwsR0FBbUJRLFFBQW5CLEVBQXpCOztBQUNBLFFBQUksS0FBS1osUUFBVCxFQUFtQjtBQUNqQlMsTUFBQUEsUUFBUSxDQUFDRSxHQUFULENBQWEsZUFBYixFQUErQixVQUFTLEtBQUtYLFFBQVMsRUFBdEQ7QUFDRDs7QUFDRCxXQUFPUyxRQUFQO0FBQ0Q7O0FBRXNCLFFBQVZJLFVBQVUsQ0FDckJDLEdBRHFCLEVBRVM7QUFDOUIsVUFBTUQsVUFBVSxHQUFHLHFCQUFVLEtBQUtoQixNQUFMLENBQVlnQixVQUFaLENBQXVCRSxJQUF2QixDQUE0QixLQUFLbEIsTUFBakMsQ0FBVixDQUFuQixDQUQ4QixDQUU5Qjs7QUFDQSxXQUFPZ0IsVUFBVSxDQUFDQyxHQUFELEVBQU0sS0FBS04sV0FBTCxFQUFOLENBQWpCO0FBQ0Q7O0FBRXlCLFFBQWJRLGFBQWEsQ0FDeEJGLEdBRHdCLEVBRVM7QUFDakMsVUFBTUUsYUFBYSxHQUFHLHFCQUNwQixLQUFLbkIsTUFBTCxDQUFZbUIsYUFBWixDQUEwQkQsSUFBMUIsQ0FBK0IsS0FBS2xCLE1BQXBDLENBRG9CLENBQXRCLENBRGlDLENBSWpDOztBQUNBLFdBQU9tQixhQUFhLENBQUNGLEdBQUQsRUFBTSxLQUFLTixXQUFMLEVBQU4sQ0FBcEI7QUFDRDs7QUFFd0IsUUFBWlMsWUFBWSxDQUN2QkgsR0FEdUIsRUFFUztBQUNoQyxVQUFNRyxZQUFZLEdBQUcscUJBQVUsS0FBS3BCLE1BQUwsQ0FBWW9CLFlBQVosQ0FBeUJGLElBQXpCLENBQThCLEtBQUtsQixNQUFuQyxDQUFWLENBQXJCLENBRGdDLENBRWhDOztBQUNBLFdBQU9vQixZQUFZLENBQUNILEdBQUQsRUFBTSxLQUFLTixXQUFMLEVBQU4sQ0FBbkI7QUFDRDs7QUFFeUIsUUFBYlUsYUFBYSxDQUN4QkosR0FEd0IsRUFFUztBQUNqQyxVQUFNSSxhQUFhLEdBQUcscUJBQ3BCLEtBQUtyQixNQUFMLENBQVlxQixhQUFaLENBQTBCSCxJQUExQixDQUErQixLQUFLbEIsTUFBcEMsQ0FEb0IsQ0FBdEIsQ0FEaUMsQ0FJakM7O0FBQ0EsV0FBT3FCLGFBQWEsQ0FBQ0osR0FBRCxFQUFNLEtBQUtOLFdBQUwsRUFBTixDQUFwQjtBQUNEOztBQUVzQixRQUFWVyxVQUFVLENBQ3JCTCxHQURxQixFQUVTO0FBQzlCLFVBQU1LLFVBQVUsR0FBRyxxQkFBVSxLQUFLdEIsTUFBTCxDQUFZc0IsVUFBWixDQUF1QkosSUFBdkIsQ0FBNEIsS0FBS2xCLE1BQWpDLENBQVYsQ0FBbkIsQ0FEOEIsQ0FFOUI7O0FBQ0EsV0FBT3NCLFVBQVUsQ0FBQ0wsR0FBRCxFQUFNLEtBQUtOLFdBQUwsRUFBTixDQUFqQjtBQUNEOztBQUUyQixRQUFmWSxlQUFlLENBQzFCTixHQUQwQixFQUVTO0FBQ25DLFVBQU1NLGVBQWUsR0FBRyxxQkFDdEIsS0FBS3ZCLE1BQUwsQ0FBWXVCLGVBQVosQ0FBNEJMLElBQTVCLENBQWlDLEtBQUtsQixNQUF0QyxDQURzQixDQUF4QixDQURtQyxDQUluQzs7QUFDQSxXQUFPdUIsZUFBZSxDQUFDTixHQUFELEVBQU0sS0FBS04sV0FBTCxFQUFOLENBQXRCO0FBQ0Q7O0FBRThCLFFBQWxCYSxrQkFBa0IsQ0FDN0JQLEdBRDZCLEVBRVM7QUFDdEMsVUFBTU8sa0JBQWtCLEdBQUcscUJBQ3pCLEtBQUt4QixNQUFMLENBQVl3QixrQkFBWixDQUErQk4sSUFBL0IsQ0FBb0MsS0FBS2xCLE1BQXpDLENBRHlCLENBQTNCLENBRHNDLENBSXRDOztBQUNBLFdBQU93QixrQkFBa0IsQ0FBQ1AsR0FBRCxFQUFNLEtBQUtOLFdBQUwsRUFBTixDQUF6QjtBQUNEOztBQUV3QixRQUFaYyxZQUFZLENBQ3ZCUixHQUR1QixFQUVTO0FBQ2hDLFVBQU1RLFlBQVksR0FBRyxxQkFBVSxLQUFLekIsTUFBTCxDQUFZeUIsWUFBWixDQUF5QlAsSUFBekIsQ0FBOEIsS0FBS2xCLE1BQW5DLENBQVYsQ0FBckIsQ0FEZ0MsQ0FFaEM7O0FBQ0EsV0FBT3lCLFlBQVksQ0FBQ1IsR0FBRCxFQUFNLEtBQUtOLFdBQUwsRUFBTixDQUFuQjtBQUNEOztBQUVzQixRQUFWZSxVQUFVLENBQ3JCVCxHQURxQixFQUVTO0FBQzlCLFVBQU1TLFVBQVUsR0FBRyxxQkFBVSxLQUFLMUIsTUFBTCxDQUFZMEIsVUFBWixDQUF1QlIsSUFBdkIsQ0FBNEIsS0FBS2xCLE1BQWpDLENBQVYsQ0FBbkIsQ0FEOEIsQ0FFOUI7O0FBQ0EsV0FBTzBCLFVBQVUsQ0FBQ1QsR0FBRCxFQUFNLEtBQUtOLFdBQUwsRUFBTixDQUFqQjtBQUNEOztBQUVnQyxRQUFwQmdCLG9CQUFvQixDQUMvQlYsR0FEK0IsRUFFUztBQUN4QyxVQUFNVSxvQkFBb0IsR0FBRyxxQkFDM0IsS0FBSzNCLE1BQUwsQ0FBWTJCLG9CQUFaLENBQWlDVCxJQUFqQyxDQUFzQyxLQUFLbEIsTUFBM0MsQ0FEMkIsQ0FBN0IsQ0FEd0MsQ0FJeEM7O0FBQ0EsV0FBTzJCLG9CQUFvQixDQUFDVixHQUFELEVBQU0sS0FBS04sV0FBTCxFQUFOLENBQTNCO0FBQ0Q7O0FBRXFCLFFBQVRpQixTQUFTLENBQUNYLEdBQUQsRUFBc0Q7QUFDMUUsVUFBTVcsU0FBUyxHQUFHLHFCQUFVLEtBQUs1QixNQUFMLENBQVk0QixTQUFaLENBQXNCVixJQUF0QixDQUEyQixLQUFLbEIsTUFBaEMsQ0FBVixDQUFsQixDQUQwRSxDQUUxRTs7QUFDQSxXQUFPNEIsU0FBUyxDQUFDWCxHQUFELEVBQU0sS0FBS04sV0FBTCxFQUFOLENBQWhCO0FBQ0Q7O0FBRXdCLFFBQVprQixZQUFZLENBQ3ZCWixHQUR1QixFQUVTO0FBQ2hDLFVBQU1ZLFlBQVksR0FBRyxxQkFBVSxLQUFLN0IsTUFBTCxDQUFZNkIsWUFBWixDQUF5QlgsSUFBekIsQ0FBOEIsS0FBS2xCLE1BQW5DLENBQVYsQ0FBckIsQ0FEZ0MsQ0FFaEM7O0FBQ0EsV0FBTzZCLFlBQVksQ0FBQ1osR0FBRCxFQUFNLEtBQUtOLFdBQUwsRUFBTixDQUFuQjtBQUNEOztBQUVtQixRQUFQbUIsT0FBTyxDQUFDYixHQUFELEVBQWtEO0FBQ3BFLFVBQU1hLE9BQU8sR0FBRyxxQkFBVSxLQUFLOUIsTUFBTCxDQUFZOEIsT0FBWixDQUFvQlosSUFBcEIsQ0FBeUIsS0FBS2xCLE1BQTlCLENBQVYsQ0FBaEIsQ0FEb0UsQ0FFcEU7O0FBQ0EsV0FBTzhCLE9BQU8sQ0FBQ2IsR0FBRCxFQUFNLEtBQUtOLFdBQUwsRUFBTixDQUFkO0FBQ0Q7O0FBRXdDLFFBQTVCb0IsNEJBQTRCLENBQ3ZDZCxHQUR1QyxFQUVTO0FBQ2hELFVBQU1jLDRCQUE0QixHQUFHLHFCQUNuQyxLQUFLL0IsTUFBTCxDQUFZK0IsNEJBQVosQ0FBeUNiLElBQXpDLENBQThDLEtBQUtsQixNQUFuRCxDQURtQyxDQUFyQyxDQURnRCxDQUloRDs7QUFDQSxXQUFPK0IsNEJBQTRCLENBQUNkLEdBQUQsRUFBTSxLQUFLTixXQUFMLEVBQU4sQ0FBbkM7QUFDRDs7QUFFTXFCLEVBQUFBLFlBQVksQ0FDakJmLEdBRGlCLEVBRTRCO0FBQzdDO0FBQ0EsV0FBTyxLQUFLakIsTUFBTCxDQUFZZ0MsWUFBWixDQUF5QmYsR0FBekIsRUFBOEIsS0FBS04sV0FBTCxFQUE5QixDQUFQO0FBQ0Q7O0FBRU1zQixFQUFBQSxVQUFVLENBQ2ZoQixHQURlLEVBRTRCO0FBQzNDO0FBQ0EsV0FBTyxLQUFLakIsTUFBTCxDQUFZaUMsVUFBWixDQUF1QmhCLEdBQXZCLEVBQTRCLEtBQUtOLFdBQUwsRUFBNUIsQ0FBUDtBQUNEOztBQWxNa0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBwcm90b0xvYWRlciBmcm9tIFwiQGdycGMvcHJvdG8tbG9hZGVyXCI7XG5pbXBvcnQgZ3JwYyBmcm9tIFwiZ3JwY1wiO1xuaW1wb3J0IHsgcHJvbWlzaWZ5IH0gZnJvbSBcInV0aWxcIjtcbmltcG9ydCB7IFJPT1RfQ0VSVFMgfSBmcm9tIFwiLi9yb290LWNlcnRzXCI7XG5pbXBvcnQge1xuICBDbGllbnRSZWFkYWJsZVN0cmVhbSxcbiAgSUVzdGltYXRlQWN0aW9uR2FzQ29uc3VtcHRpb25SZXF1ZXN0LFxuICBJRXN0aW1hdGVBY3Rpb25HYXNDb25zdW1wdGlvblJlc3BvbnNlLFxuICBJRXN0aW1hdGVHYXNGb3JBY3Rpb25SZXF1ZXN0LFxuICBJRXN0aW1hdGVHYXNGb3JBY3Rpb25SZXNwb25zZSxcbiAgSUdldEFjY291bnRSZXF1ZXN0LFxuICBJR2V0QWNjb3VudFJlc3BvbnNlLFxuICBJR2V0QWN0aW9uc1JlcXVlc3QsXG4gIElHZXRBY3Rpb25zUmVzcG9uc2UsXG4gIElHZXRCbG9ja01ldGFzUmVxdWVzdCxcbiAgSUdldEJsb2NrTWV0YXNSZXNwb25zZSxcbiAgSUdldENoYWluTWV0YVJlcXVlc3QsXG4gIElHZXRDaGFpbk1ldGFSZXNwb25zZSxcbiAgSUdldEVwb2NoTWV0YVJlcXVlc3QsXG4gIElHZXRFcG9jaE1ldGFSZXNwb25zZSxcbiAgSUdldExvZ3NSZXF1ZXN0LFxuICBJR2V0TG9nc1Jlc3BvbnNlLFxuICBJR2V0UmVjZWlwdEJ5QWN0aW9uUmVxdWVzdCxcbiAgSUdldFJlY2VpcHRCeUFjdGlvblJlc3BvbnNlLFxuICBJR2V0U2VydmVyTWV0YVJlcXVlc3QsXG4gIElHZXRTZXJ2ZXJNZXRhUmVzcG9uc2UsXG4gIElSZWFkQ29udHJhY3RSZXF1ZXN0LFxuICBJUmVhZENvbnRyYWN0UmVzcG9uc2UsXG4gIElSZWFkU3RhdGVSZXF1ZXN0LFxuICBJUmVhZFN0YXRlUmVzcG9uc2UsXG4gIElScGNNZXRob2QsXG4gIElTZW5kQWN0aW9uUmVxdWVzdCxcbiAgSVNlbmRBY3Rpb25SZXNwb25zZSxcbiAgSVN0cmVhbUJsb2Nrc1JlcXVlc3QsXG4gIElTdHJlYW1CbG9ja3NSZXNwb25zZSxcbiAgSVN0cmVhbUxvZ3NSZXF1ZXN0LFxuICBJU3RyZWFtTG9nc1Jlc3BvbnNlLFxuICBJU3VnZ2VzdEdhc1ByaWNlUmVxdWVzdCxcbiAgSVN1Z2dlc3RHYXNQcmljZVJlc3BvbnNlXG59IGZyb20gXCIuL3R5cGVzXCI7XG5cbmNvbnN0IHBhY2thZ2VEZWZpbml0aW9uID0gcHJvdG9Mb2FkZXIubG9hZFN5bmMoXG4gIGAke19fZGlybmFtZX0vLi4vLi4vcHJvdG8vYXBpL2FwaS5wcm90b2AsXG4gIHtcbiAgICBrZWVwQ2FzZTogdHJ1ZSxcbiAgICBsb25nczogU3RyaW5nLFxuICAgIGVudW1zOiBTdHJpbmcsXG4gICAgZGVmYXVsdHM6IHRydWUsXG4gICAgb25lb2ZzOiB0cnVlLFxuICAgIGluY2x1ZGVEaXJzOiBbYCR7X19kaXJuYW1lfS8uLi8uLi9gXVxuICB9XG4pO1xuY29uc3QgaW90ZXhhcGkgPSBncnBjLmxvYWRQYWNrYWdlRGVmaW5pdGlvbihwYWNrYWdlRGVmaW5pdGlvbikuaW90ZXhhcGk7XG5cbnR5cGUgT3B0cyA9IHtcbiAgdGltZW91dD86IG51bWJlcjtcbiAgZW5hYmxlU3NsPzogYm9vbGVhbjtcbiAgYXBpVG9rZW4/OiBzdHJpbmc7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBScGNNZXRob2QgaW1wbGVtZW50cyBJUnBjTWV0aG9kIHtcbiAgcHVibGljIGNsaWVudDogSVJwY01ldGhvZDtcbiAgcHVibGljIHRpbWVvdXQ6IG51bWJlcjtcbiAgcHVibGljIGFwaVRva2VuPzogc3RyaW5nO1xuICBwcml2YXRlIGNyZWRlbnRpYWxzOiBncnBjLkNoYW5uZWxDcmVkZW50aWFscztcblxuICBjb25zdHJ1Y3Rvcihob3N0bmFtZTogc3RyaW5nLCBvcHRpb25zOiBPcHRzID0ge30pIHtcbiAgICBjb25zdCBub3JtYWxpemVkSG9zdG5hbWUgPSBTdHJpbmcoaG9zdG5hbWUpLnJlcGxhY2UoXG4gICAgICAvXihodHRwOlxcL1xcL3xodHRwczpcXC9cXC8pLyxcbiAgICAgIFwiXCJcbiAgICApO1xuICAgIGlmIChob3N0bmFtZS5zdGFydHNXaXRoKFwiaHR0cHM6Ly9cIikpIHtcbiAgICAgIG9wdGlvbnMuZW5hYmxlU3NsID0gdHJ1ZTtcbiAgICB9XG4gICAgdGhpcy5jcmVkZW50aWFscyA9XG4gICAgICBvcHRpb25zICYmIG9wdGlvbnMuZW5hYmxlU3NsXG4gICAgICAgID8gZ3JwYy5jcmVkZW50aWFscy5jcmVhdGVTc2woQnVmZmVyLmZyb20oUk9PVF9DRVJUUykpXG4gICAgICAgIDogZ3JwYy5jcmVkZW50aWFscy5jcmVhdGVJbnNlY3VyZSgpO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICB0aGlzLmNsaWVudCA9IG5ldyBpb3RleGFwaS5BUElTZXJ2aWNlKFxuICAgICAgbm9ybWFsaXplZEhvc3RuYW1lLFxuICAgICAgdGhpcy5jcmVkZW50aWFscyxcbiAgICAgIG51bGxcbiAgICApO1xuICAgIHRoaXMudGltZW91dCA9IG9wdGlvbnMudGltZW91dCB8fCAzMDAwMDA7XG4gICAgdGhpcy5hcGlUb2tlbiA9IG9wdGlvbnMuYXBpVG9rZW47XG4gIH1cblxuICBwdWJsaWMgc2V0UHJvdmlkZXIocHJvdmlkZXI6IHN0cmluZyB8IElScGNNZXRob2QpOiB2b2lkIHtcbiAgICBpZiAodHlwZW9mIHByb3ZpZGVyID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBjb25zdCBub3JtYWxpemVkSG9zdG5hbWUgPSBTdHJpbmcocHJvdmlkZXIpLnJlcGxhY2UoXG4gICAgICAgIC9eKGh0dHA6XFwvXFwvfGh0dHBzOlxcL1xcLykvLFxuICAgICAgICBcIlwiXG4gICAgICApO1xuICAgICAgdGhpcy5jcmVkZW50aWFscyA9IHByb3ZpZGVyLnN0YXJ0c1dpdGgoXCJodHRwczovL1wiKVxuICAgICAgICA/IGdycGMuY3JlZGVudGlhbHMuY3JlYXRlU3NsKEJ1ZmZlci5mcm9tKFJPT1RfQ0VSVFMpKVxuICAgICAgICA6IGdycGMuY3JlZGVudGlhbHMuY3JlYXRlSW5zZWN1cmUoKTtcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIHRoaXMuY2xpZW50ID0gbmV3IGlvdGV4YXBpLkFQSVNlcnZpY2UoXG4gICAgICAgIG5vcm1hbGl6ZWRIb3N0bmFtZSxcbiAgICAgICAgdGhpcy5jcmVkZW50aWFscyxcbiAgICAgICAgbnVsbFxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgb3JpZ2luID0gcHJvdmlkZXIgYXMgUnBjTWV0aG9kO1xuICAgICAgdGhpcy5jbGllbnQgPSBvcmlnaW4uY2xpZW50O1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXREZWFkbGluZSgpOiBudW1iZXIge1xuICAgIHJldHVybiBuZXcgRGF0ZShEYXRlLm5vdygpICsgdGhpcy50aW1lb3V0KS5nZXRUaW1lKCk7XG4gIH1cblxuICBwcml2YXRlIGdldE1ldGFkYXRhKCk6IGdycGMuTWV0YWRhdGEge1xuICAgIGNvbnN0IG1ldGFkYXRhID0gbmV3IGdycGMuTWV0YWRhdGEoKTtcbiAgICBtZXRhZGF0YS5hZGQoXCJkZWFkbGluZVwiLCB0aGlzLmdldERlYWRsaW5lKCkudG9TdHJpbmcoKSk7XG4gICAgaWYgKHRoaXMuYXBpVG9rZW4pIHtcbiAgICAgIG1ldGFkYXRhLmFkZChcImF1dGhvcml6YXRpb25cIiwgYGJlYXJlciAke3RoaXMuYXBpVG9rZW59YCk7XG4gICAgfVxuICAgIHJldHVybiBtZXRhZGF0YTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBnZXRBY2NvdW50KFxuICAgIHJlcTogSUdldEFjY291bnRSZXF1ZXN0XG4gICk6IFByb21pc2U8SUdldEFjY291bnRSZXNwb25zZT4ge1xuICAgIGNvbnN0IGdldEFjY291bnQgPSBwcm9taXNpZnkodGhpcy5jbGllbnQuZ2V0QWNjb3VudC5iaW5kKHRoaXMuY2xpZW50KSk7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHJldHVybiBnZXRBY2NvdW50KHJlcSwgdGhpcy5nZXRNZXRhZGF0YSgpKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBnZXRCbG9ja01ldGFzKFxuICAgIHJlcTogSUdldEJsb2NrTWV0YXNSZXF1ZXN0XG4gICk6IFByb21pc2U8SUdldEJsb2NrTWV0YXNSZXNwb25zZT4ge1xuICAgIGNvbnN0IGdldEJsb2NrTWV0YXMgPSBwcm9taXNpZnkoXG4gICAgICB0aGlzLmNsaWVudC5nZXRCbG9ja01ldGFzLmJpbmQodGhpcy5jbGllbnQpXG4gICAgKTtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcmV0dXJuIGdldEJsb2NrTWV0YXMocmVxLCB0aGlzLmdldE1ldGFkYXRhKCkpO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGdldENoYWluTWV0YShcbiAgICByZXE6IElHZXRDaGFpbk1ldGFSZXF1ZXN0XG4gICk6IFByb21pc2U8SUdldENoYWluTWV0YVJlc3BvbnNlPiB7XG4gICAgY29uc3QgZ2V0Q2hhaW5NZXRhID0gcHJvbWlzaWZ5KHRoaXMuY2xpZW50LmdldENoYWluTWV0YS5iaW5kKHRoaXMuY2xpZW50KSk7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHJldHVybiBnZXRDaGFpbk1ldGEocmVxLCB0aGlzLmdldE1ldGFkYXRhKCkpO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGdldFNlcnZlck1ldGEoXG4gICAgcmVxOiBJR2V0U2VydmVyTWV0YVJlcXVlc3RcbiAgKTogUHJvbWlzZTxJR2V0U2VydmVyTWV0YVJlc3BvbnNlPiB7XG4gICAgY29uc3QgZ2V0U2VydmVyTWV0YSA9IHByb21pc2lmeShcbiAgICAgIHRoaXMuY2xpZW50LmdldFNlcnZlck1ldGEuYmluZCh0aGlzLmNsaWVudClcbiAgICApO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICByZXR1cm4gZ2V0U2VydmVyTWV0YShyZXEsIHRoaXMuZ2V0TWV0YWRhdGEoKSk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2V0QWN0aW9ucyhcbiAgICByZXE6IElHZXRBY3Rpb25zUmVxdWVzdFxuICApOiBQcm9taXNlPElHZXRBY3Rpb25zUmVzcG9uc2U+IHtcbiAgICBjb25zdCBnZXRBY3Rpb25zID0gcHJvbWlzaWZ5KHRoaXMuY2xpZW50LmdldEFjdGlvbnMuYmluZCh0aGlzLmNsaWVudCkpO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICByZXR1cm4gZ2V0QWN0aW9ucyhyZXEsIHRoaXMuZ2V0TWV0YWRhdGEoKSk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgc3VnZ2VzdEdhc1ByaWNlKFxuICAgIHJlcTogSVN1Z2dlc3RHYXNQcmljZVJlcXVlc3RcbiAgKTogUHJvbWlzZTxJU3VnZ2VzdEdhc1ByaWNlUmVzcG9uc2U+IHtcbiAgICBjb25zdCBzdWdnZXN0R2FzUHJpY2UgPSBwcm9taXNpZnkoXG4gICAgICB0aGlzLmNsaWVudC5zdWdnZXN0R2FzUHJpY2UuYmluZCh0aGlzLmNsaWVudClcbiAgICApO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICByZXR1cm4gc3VnZ2VzdEdhc1ByaWNlKHJlcSwgdGhpcy5nZXRNZXRhZGF0YSgpKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBnZXRSZWNlaXB0QnlBY3Rpb24oXG4gICAgcmVxOiBJR2V0UmVjZWlwdEJ5QWN0aW9uUmVxdWVzdFxuICApOiBQcm9taXNlPElHZXRSZWNlaXB0QnlBY3Rpb25SZXNwb25zZT4ge1xuICAgIGNvbnN0IGdldFJlY2VpcHRCeUFjdGlvbiA9IHByb21pc2lmeShcbiAgICAgIHRoaXMuY2xpZW50LmdldFJlY2VpcHRCeUFjdGlvbi5iaW5kKHRoaXMuY2xpZW50KVxuICAgICk7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHJldHVybiBnZXRSZWNlaXB0QnlBY3Rpb24ocmVxLCB0aGlzLmdldE1ldGFkYXRhKCkpO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIHJlYWRDb250cmFjdChcbiAgICByZXE6IElSZWFkQ29udHJhY3RSZXF1ZXN0XG4gICk6IFByb21pc2U8SVJlYWRDb250cmFjdFJlc3BvbnNlPiB7XG4gICAgY29uc3QgcmVhZENvbnRyYWN0ID0gcHJvbWlzaWZ5KHRoaXMuY2xpZW50LnJlYWRDb250cmFjdC5iaW5kKHRoaXMuY2xpZW50KSk7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHJldHVybiByZWFkQ29udHJhY3QocmVxLCB0aGlzLmdldE1ldGFkYXRhKCkpO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIHNlbmRBY3Rpb24oXG4gICAgcmVxOiBJU2VuZEFjdGlvblJlcXVlc3RcbiAgKTogUHJvbWlzZTxJU2VuZEFjdGlvblJlc3BvbnNlPiB7XG4gICAgY29uc3Qgc2VuZEFjdGlvbiA9IHByb21pc2lmeSh0aGlzLmNsaWVudC5zZW5kQWN0aW9uLmJpbmQodGhpcy5jbGllbnQpKTtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcmV0dXJuIHNlbmRBY3Rpb24ocmVxLCB0aGlzLmdldE1ldGFkYXRhKCkpO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGVzdGltYXRlR2FzRm9yQWN0aW9uKFxuICAgIHJlcTogSUVzdGltYXRlR2FzRm9yQWN0aW9uUmVxdWVzdFxuICApOiBQcm9taXNlPElFc3RpbWF0ZUdhc0ZvckFjdGlvblJlc3BvbnNlPiB7XG4gICAgY29uc3QgZXN0aW1hdGVHYXNGb3JBY3Rpb24gPSBwcm9taXNpZnkoXG4gICAgICB0aGlzLmNsaWVudC5lc3RpbWF0ZUdhc0ZvckFjdGlvbi5iaW5kKHRoaXMuY2xpZW50KVxuICAgICk7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHJldHVybiBlc3RpbWF0ZUdhc0ZvckFjdGlvbihyZXEsIHRoaXMuZ2V0TWV0YWRhdGEoKSk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgcmVhZFN0YXRlKHJlcTogSVJlYWRTdGF0ZVJlcXVlc3QpOiBQcm9taXNlPElSZWFkU3RhdGVSZXNwb25zZT4ge1xuICAgIGNvbnN0IHJlYWRTdGF0ZSA9IHByb21pc2lmeSh0aGlzLmNsaWVudC5yZWFkU3RhdGUuYmluZCh0aGlzLmNsaWVudCkpO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICByZXR1cm4gcmVhZFN0YXRlKHJlcSwgdGhpcy5nZXRNZXRhZGF0YSgpKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBnZXRFcG9jaE1ldGEoXG4gICAgcmVxOiBJR2V0RXBvY2hNZXRhUmVxdWVzdFxuICApOiBQcm9taXNlPElHZXRFcG9jaE1ldGFSZXNwb25zZT4ge1xuICAgIGNvbnN0IGdldEVwb2NoTWV0YSA9IHByb21pc2lmeSh0aGlzLmNsaWVudC5nZXRFcG9jaE1ldGEuYmluZCh0aGlzLmNsaWVudCkpO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICByZXR1cm4gZ2V0RXBvY2hNZXRhKHJlcSwgdGhpcy5nZXRNZXRhZGF0YSgpKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBnZXRMb2dzKHJlcTogSUdldExvZ3NSZXF1ZXN0KTogUHJvbWlzZTxJR2V0TG9nc1Jlc3BvbnNlPiB7XG4gICAgY29uc3QgZ2V0TG9ncyA9IHByb21pc2lmeSh0aGlzLmNsaWVudC5nZXRMb2dzLmJpbmQodGhpcy5jbGllbnQpKTtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcmV0dXJuIGdldExvZ3MocmVxLCB0aGlzLmdldE1ldGFkYXRhKCkpO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGVzdGltYXRlQWN0aW9uR2FzQ29uc3VtcHRpb24oXG4gICAgcmVxOiBJRXN0aW1hdGVBY3Rpb25HYXNDb25zdW1wdGlvblJlcXVlc3RcbiAgKTogUHJvbWlzZTxJRXN0aW1hdGVBY3Rpb25HYXNDb25zdW1wdGlvblJlc3BvbnNlPiB7XG4gICAgY29uc3QgZXN0aW1hdGVBY3Rpb25HYXNDb25zdW1wdGlvbiA9IHByb21pc2lmeShcbiAgICAgIHRoaXMuY2xpZW50LmVzdGltYXRlQWN0aW9uR2FzQ29uc3VtcHRpb24uYmluZCh0aGlzLmNsaWVudClcbiAgICApO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICByZXR1cm4gZXN0aW1hdGVBY3Rpb25HYXNDb25zdW1wdGlvbihyZXEsIHRoaXMuZ2V0TWV0YWRhdGEoKSk7XG4gIH1cblxuICBwdWJsaWMgc3RyZWFtQmxvY2tzKFxuICAgIHJlcTogSVN0cmVhbUJsb2Nrc1JlcXVlc3RcbiAgKTogQ2xpZW50UmVhZGFibGVTdHJlYW08SVN0cmVhbUJsb2Nrc1Jlc3BvbnNlPiB7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHJldHVybiB0aGlzLmNsaWVudC5zdHJlYW1CbG9ja3MocmVxLCB0aGlzLmdldE1ldGFkYXRhKCkpO1xuICB9XG5cbiAgcHVibGljIHN0cmVhbUxvZ3MoXG4gICAgcmVxOiBJU3RyZWFtTG9nc1JlcXVlc3RcbiAgKTogQ2xpZW50UmVhZGFibGVTdHJlYW08SVN0cmVhbUxvZ3NSZXNwb25zZT4ge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICByZXR1cm4gdGhpcy5jbGllbnQuc3RyZWFtTG9ncyhyZXEsIHRoaXMuZ2V0TWV0YWRhdGEoKSk7XG4gIH1cbn1cbiJdfQ==