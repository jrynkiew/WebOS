"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _api_grpc_web_pb = _interopRequireDefault(require("../../protogen/proto/api/api_grpc_web_pb"));

var _types = require("./types");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

class RpcMethod {
  constructor(hostname, options = {}) {
    _defineProperty(this, "client", void 0);

    _defineProperty(this, "timeout", void 0);

    _defineProperty(this, "apiToken", void 0);

    this.client = new _api_grpc_web_pb.default.APIServicePromiseClient(hostname, null, null);
    this.timeout = options.timeout || 300000;
    this.apiToken = options.apiToken;
  }

  setProvider(provider) {
    if (typeof provider === "string") {
      this.client = new _api_grpc_web_pb.default.APIServicePromiseClient(provider, null, null);
    } else {
      const origin = provider;
      this.client = origin.client;
    }
  }

  getDeadline() {
    return `${new Date(Date.now() + this.timeout).getTime()}`;
  }

  getMetadata() {
    if (this.apiToken) {
      return {
        deadline: this.getDeadline(),
        authorization: `bearer ${this.apiToken}`
      };
    }

    return {
      deadline: this.getDeadline()
    };
  }

  async getAccount(req) {
    const pbReq = _types.GetAccountRequest.to(req);

    const pbResp = await this.client.getAccount(pbReq, this.getMetadata());
    return _types.GetAccountRequest.from(pbResp);
  }

  async getBlockMetas(req) {
    const pbReq = _types.GetBlockMetasRequest.to(req);

    const pbResp = await this.client.getBlockMetas(pbReq, this.getMetadata());
    return _types.GetBlockMetasRequest.from(pbResp);
  }

  async getChainMeta(req) {
    const pbReq = _types.GetChainMetaRequest.to(req);

    const pbResp = await this.client.getChainMeta(pbReq, this.getMetadata());
    return _types.GetChainMetaRequest.from(pbResp);
  }

  async getServerMeta(req) {
    const pbReq = _types.GetServerMetaRequest.to(req);

    const pbResp = await this.client.getServerMeta(pbReq, this.getMetadata());
    return _types.GetServerMetaRequest.from(pbResp);
  }

  async getActions(req) {
    const pbReq = _types.GetActionsRequest.to(req);

    const pbResp = await this.client.getActions(pbReq, this.getMetadata());
    return _types.GetActionsRequest.from(pbResp);
  }

  async suggestGasPrice(req) {
    const pbReq = _types.SuggestGasPriceRequest.to(req);

    const pbResp = await this.client.suggestGasPrice(pbReq, this.getMetadata());
    return _types.SuggestGasPriceRequest.from(pbResp);
  }

  async estimateGasForAction(req) {
    const pbReq = _types.EstimateGasForActionRequest.to(req);

    const pbResp = await this.client.estimateGasForAction(pbReq, this.getMetadata());
    return _types.EstimateGasForActionRequest.from(pbResp);
  }

  async readState(req) {
    const pbReq = _types.ReadStateRequest.to(req);

    const pbResp = await this.client.readState(pbReq, this.getMetadata());
    return _types.ReadStateRequest.from(pbResp);
  }

  async readContract(req) {
    const pbReq = _types.ReadContractRequest.to(req);

    const pbResp = await this.client.readContract(pbReq, this.getMetadata());
    return _types.ReadContractRequest.from(pbResp);
  }

  async sendAction(req) {
    const pbReq = _types.SendActionRequest.to(req);

    const pbResp = await this.client.sendAction(pbReq, this.getMetadata());
    return _types.SendActionResponse.from(pbResp);
  }

  async getReceiptByAction(req) {
    const pbReq = _types.GetReceiptByActionRequest.to(req);

    const pbResp = await this.client.getReceiptByAction(pbReq, this.getMetadata());
    return _types.GetReceiptByActionRequest.from(pbResp);
  }

  async getEpochMeta(req) {
    const pbReq = _types.GetEpochMetaRequest.to(req);

    const pbResp = await this.client.getEpochMeta(pbReq, this.getMetadata());
    return _types.GetEpochMetaRequest.from(pbResp);
  }

  async getLogs(req) {
    const pbReq = _types.GetLogsRequest.to(req);

    const pbResp = await this.client.getLogs(pbReq, this.getMetadata());
    return _types.GetLogsRequest.from(pbResp);
  }

  async estimateActionGasConsumption(req) {
    const pbReq = _types.EstimateActionGasConsumptionRequest.to(req);

    const pbResp = await this.client.estimateActionGasConsumption(pbReq, this.getMetadata());
    return _types.EstimateActionGasConsumptionRequest.from(pbResp);
  }

  streamBlocks(req) {
    const pbReq = _types.StreamBlocksRequest.to(req); // @ts-ignore


    const origin = this.client.streamBlocks(pbReq, this.getMetadata());
    return new _types.ClientReadableStream(origin, "StreamBlocks");
  }

  streamLogs(req) {
    const pbReq = _types.StreamLogsRequest.to(req); // @ts-ignore


    const origin = this.client.streamLogs(pbReq, this.getMetadata());
    return new _types.ClientReadableStream(origin, "StreamLogs");
  }

}

exports.default = RpcMethod;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ycGMtbWV0aG9kL2Jyb3dzZXItcnBjLW1ldGhvZC50cyJdLCJuYW1lcyI6WyJScGNNZXRob2QiLCJjb25zdHJ1Y3RvciIsImhvc3RuYW1lIiwib3B0aW9ucyIsImNsaWVudCIsImdycGNXZWIiLCJBUElTZXJ2aWNlUHJvbWlzZUNsaWVudCIsInRpbWVvdXQiLCJhcGlUb2tlbiIsInNldFByb3ZpZGVyIiwicHJvdmlkZXIiLCJvcmlnaW4iLCJnZXREZWFkbGluZSIsIkRhdGUiLCJub3ciLCJnZXRUaW1lIiwiZ2V0TWV0YWRhdGEiLCJkZWFkbGluZSIsImF1dGhvcml6YXRpb24iLCJnZXRBY2NvdW50IiwicmVxIiwicGJSZXEiLCJHZXRBY2NvdW50UmVxdWVzdCIsInRvIiwicGJSZXNwIiwiZnJvbSIsImdldEJsb2NrTWV0YXMiLCJHZXRCbG9ja01ldGFzUmVxdWVzdCIsImdldENoYWluTWV0YSIsIkdldENoYWluTWV0YVJlcXVlc3QiLCJnZXRTZXJ2ZXJNZXRhIiwiR2V0U2VydmVyTWV0YVJlcXVlc3QiLCJnZXRBY3Rpb25zIiwiR2V0QWN0aW9uc1JlcXVlc3QiLCJzdWdnZXN0R2FzUHJpY2UiLCJTdWdnZXN0R2FzUHJpY2VSZXF1ZXN0IiwiZXN0aW1hdGVHYXNGb3JBY3Rpb24iLCJFc3RpbWF0ZUdhc0ZvckFjdGlvblJlcXVlc3QiLCJyZWFkU3RhdGUiLCJSZWFkU3RhdGVSZXF1ZXN0IiwicmVhZENvbnRyYWN0IiwiUmVhZENvbnRyYWN0UmVxdWVzdCIsInNlbmRBY3Rpb24iLCJTZW5kQWN0aW9uUmVxdWVzdCIsIlNlbmRBY3Rpb25SZXNwb25zZSIsImdldFJlY2VpcHRCeUFjdGlvbiIsIkdldFJlY2VpcHRCeUFjdGlvblJlcXVlc3QiLCJnZXRFcG9jaE1ldGEiLCJHZXRFcG9jaE1ldGFSZXF1ZXN0IiwiZ2V0TG9ncyIsIkdldExvZ3NSZXF1ZXN0IiwiZXN0aW1hdGVBY3Rpb25HYXNDb25zdW1wdGlvbiIsIkVzdGltYXRlQWN0aW9uR2FzQ29uc3VtcHRpb25SZXF1ZXN0Iiwic3RyZWFtQmxvY2tzIiwiU3RyZWFtQmxvY2tzUmVxdWVzdCIsIkNsaWVudFJlYWRhYmxlU3RyZWFtIiwic3RyZWFtTG9ncyIsIlN0cmVhbUxvZ3NSZXF1ZXN0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7Ozs7OztBQThEZSxNQUFNQSxTQUFOLENBQXNDO0FBS25EQyxFQUFBQSxXQUFXLENBQUNDLFFBQUQsRUFBbUJDLE9BQWEsR0FBRyxFQUFuQyxFQUF1QztBQUFBOztBQUFBOztBQUFBOztBQUNoRCxTQUFLQyxNQUFMLEdBQWMsSUFBSUMseUJBQVFDLHVCQUFaLENBQW9DSixRQUFwQyxFQUE4QyxJQUE5QyxFQUFvRCxJQUFwRCxDQUFkO0FBQ0EsU0FBS0ssT0FBTCxHQUFlSixPQUFPLENBQUNJLE9BQVIsSUFBbUIsTUFBbEM7QUFDQSxTQUFLQyxRQUFMLEdBQWdCTCxPQUFPLENBQUNLLFFBQXhCO0FBQ0Q7O0FBRU1DLEVBQUFBLFdBQVcsQ0FBQ0MsUUFBRCxFQUFzQztBQUN0RCxRQUFJLE9BQU9BLFFBQVAsS0FBb0IsUUFBeEIsRUFBa0M7QUFDaEMsV0FBS04sTUFBTCxHQUFjLElBQUlDLHlCQUFRQyx1QkFBWixDQUFvQ0ksUUFBcEMsRUFBOEMsSUFBOUMsRUFBb0QsSUFBcEQsQ0FBZDtBQUNELEtBRkQsTUFFTztBQUNMLFlBQU1DLE1BQU0sR0FBR0QsUUFBZjtBQUNBLFdBQUtOLE1BQUwsR0FBY08sTUFBTSxDQUFDUCxNQUFyQjtBQUNEO0FBQ0Y7O0FBRU1RLEVBQUFBLFdBQVcsR0FBVztBQUMzQixXQUFRLEdBQUUsSUFBSUMsSUFBSixDQUFTQSxJQUFJLENBQUNDLEdBQUwsS0FBYSxLQUFLUCxPQUEzQixFQUFvQ1EsT0FBcEMsRUFBOEMsRUFBeEQ7QUFDRDs7QUFFT0MsRUFBQUEsV0FBVyxHQUE0QjtBQUM3QyxRQUFJLEtBQUtSLFFBQVQsRUFBbUI7QUFDakIsYUFBTztBQUNMUyxRQUFBQSxRQUFRLEVBQUUsS0FBS0wsV0FBTCxFQURMO0FBRUxN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QWhDLENBQWY7QUFFQSxXQUFPLElBQUl1QywyQkFBSixDQUF5QjVDLE1BQXpCLEVBQWlDLGNBQWpDLENBQVA7QUFDRDs7QUFFTTZDLEVBQUFBLFVBQVUsQ0FDZnBDLEdBRGUsRUFFNEI7QUFDM0MsVUFBTUMsS0FBSyxHQUFHb0MseUJBQWtCbEMsRUFBbEIsQ0FBcUJILEdBQXJCLENBQWQsQ0FEMkMsQ0FFM0M7OztBQUNBLFVBQU1ULE1BQU0sR0FBRyxLQUFLUCxNQUFMLENBQVlvRCxVQUFaLENBQXVCbkMsS0FBdkIsRUFBOEIsS0FBS0wsV0FBTCxFQUE5QixDQUFmO0FBRUEsV0FBTyxJQUFJdUMsMkJBQUosQ0FBeUI1QyxNQUF6QixFQUFpQyxZQUFqQyxDQUFQO0FBQ0Q7O0FBM0trRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBncnBjV2ViIGZyb20gXCIuLi8uLi9wcm90b2dlbi9wcm90by9hcGkvYXBpX2dycGNfd2ViX3BiXCI7XG5pbXBvcnQge1xuICBDbGllbnRSZWFkYWJsZVN0cmVhbSxcbiAgRXN0aW1hdGVBY3Rpb25HYXNDb25zdW1wdGlvblJlcXVlc3QsXG4gIEdldExvZ3NSZXF1ZXN0LFxuICBHZXRTZXJ2ZXJNZXRhUmVxdWVzdCxcbiAgSUVzdGltYXRlQWN0aW9uR2FzQ29uc3VtcHRpb25SZXF1ZXN0LFxuICBJRXN0aW1hdGVBY3Rpb25HYXNDb25zdW1wdGlvblJlc3BvbnNlLFxuICBJRXN0aW1hdGVHYXNGb3JBY3Rpb25SZXF1ZXN0LFxuICBJRXN0aW1hdGVHYXNGb3JBY3Rpb25SZXNwb25zZSxcbiAgSUdldEFjY291bnRSZXF1ZXN0LFxuICBJR2V0QWNjb3VudFJlc3BvbnNlLFxuICBJR2V0QWN0aW9uc1JlcXVlc3QsXG4gIElHZXRBY3Rpb25zUmVzcG9uc2UsXG4gIElHZXRCbG9ja01ldGFzUmVxdWVzdCxcbiAgSUdldEJsb2NrTWV0YXNSZXNwb25zZSxcbiAgSUdldENoYWluTWV0YVJlcXVlc3QsXG4gIElHZXRDaGFpbk1ldGFSZXNwb25zZSxcbiAgSUdldEVwb2NoTWV0YVJlcXVlc3QsXG4gIElHZXRFcG9jaE1ldGFSZXNwb25zZSxcbiAgSUdldExvZ3NSZXF1ZXN0LFxuICBJR2V0TG9nc1Jlc3BvbnNlLFxuICBJR2V0UmVjZWlwdEJ5QWN0aW9uUmVxdWVzdCxcbiAgSUdldFJlY2VpcHRCeUFjdGlvblJlc3BvbnNlLFxuICBJR2V0U2VydmVyTWV0YVJlcXVlc3QsXG4gIElHZXRTZXJ2ZXJNZXRhUmVzcG9uc2UsXG4gIElSZWFkQ29udHJhY3RSZXF1ZXN0LFxuICBJUmVhZENvbnRyYWN0UmVzcG9uc2UsXG4gIElSZWFkU3RhdGVSZXF1ZXN0LFxuICBJUmVhZFN0YXRlUmVzcG9uc2UsXG4gIElScGNNZXRob2QsXG4gIElTZW5kQWN0aW9uUmVxdWVzdCxcbiAgSVNlbmRBY3Rpb25SZXNwb25zZSxcbiAgSVN0cmVhbUJsb2Nrc1JlcXVlc3QsXG4gIElTdHJlYW1CbG9ja3NSZXNwb25zZSxcbiAgSVN0cmVhbUxvZ3NSZXF1ZXN0LFxuICBJU3RyZWFtTG9nc1Jlc3BvbnNlLFxuICBJU3VnZ2VzdEdhc1ByaWNlUmVxdWVzdCxcbiAgSVN1Z2dlc3RHYXNQcmljZVJlc3BvbnNlLFxuICBSZWFkU3RhdGVSZXF1ZXN0LFxuICBTZW5kQWN0aW9uUmVzcG9uc2Vcbn0gZnJvbSBcIi4vdHlwZXNcIjtcblxuaW1wb3J0IHtcbiAgRXN0aW1hdGVHYXNGb3JBY3Rpb25SZXF1ZXN0LFxuICBHZXRBY2NvdW50UmVxdWVzdCxcbiAgR2V0QWN0aW9uc1JlcXVlc3QsXG4gIEdldEJsb2NrTWV0YXNSZXF1ZXN0LFxuICBHZXRDaGFpbk1ldGFSZXF1ZXN0LFxuICBHZXRFcG9jaE1ldGFSZXF1ZXN0LFxuICBHZXRSZWNlaXB0QnlBY3Rpb25SZXF1ZXN0LFxuICBSZWFkQ29udHJhY3RSZXF1ZXN0LFxuICBTZW5kQWN0aW9uUmVxdWVzdCxcbiAgU3RyZWFtQmxvY2tzUmVxdWVzdCxcbiAgU3RyZWFtTG9nc1JlcXVlc3QsXG4gIFN1Z2dlc3RHYXNQcmljZVJlcXVlc3Rcbn0gZnJvbSBcIi4vdHlwZXNcIjtcblxudHlwZSBPcHRzID0ge1xuICB0aW1lb3V0PzogbnVtYmVyO1xuICBhcGlUb2tlbj86IHN0cmluZztcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJwY01ldGhvZCBpbXBsZW1lbnRzIElScGNNZXRob2Qge1xuICBwdWJsaWMgY2xpZW50OiBncnBjV2ViLkFQSVNlcnZpY2VQcm9taXNlQ2xpZW50O1xuICBwdWJsaWMgdGltZW91dDogbnVtYmVyO1xuICBwdWJsaWMgYXBpVG9rZW4/OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoaG9zdG5hbWU6IHN0cmluZywgb3B0aW9uczogT3B0cyA9IHt9KSB7XG4gICAgdGhpcy5jbGllbnQgPSBuZXcgZ3JwY1dlYi5BUElTZXJ2aWNlUHJvbWlzZUNsaWVudChob3N0bmFtZSwgbnVsbCwgbnVsbCk7XG4gICAgdGhpcy50aW1lb3V0ID0gb3B0aW9ucy50aW1lb3V0IHx8IDMwMDAwMDtcbiAgICB0aGlzLmFwaVRva2VuID0gb3B0aW9ucy5hcGlUb2tlbjtcbiAgfVxuXG4gIHB1YmxpYyBzZXRQcm92aWRlcihwcm92aWRlcjogc3RyaW5nIHwgSVJwY01ldGhvZCk6IHZvaWQge1xuICAgIGlmICh0eXBlb2YgcHJvdmlkZXIgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRoaXMuY2xpZW50ID0gbmV3IGdycGNXZWIuQVBJU2VydmljZVByb21pc2VDbGllbnQocHJvdmlkZXIsIG51bGwsIG51bGwpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBvcmlnaW4gPSBwcm92aWRlciBhcyBScGNNZXRob2Q7XG4gICAgICB0aGlzLmNsaWVudCA9IG9yaWdpbi5jbGllbnQ7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldERlYWRsaW5lKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGAke25ldyBEYXRlKERhdGUubm93KCkgKyB0aGlzLnRpbWVvdXQpLmdldFRpbWUoKX1gO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRNZXRhZGF0YSgpOiB7IFtzOiBzdHJpbmddOiBzdHJpbmcgfSB7XG4gICAgaWYgKHRoaXMuYXBpVG9rZW4pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRlYWRsaW5lOiB0aGlzLmdldERlYWRsaW5lKCksXG4gICAgICAgIGF1dGhvcml6YXRpb246IGBiZWFyZXIgJHt0aGlzLmFwaVRva2VufWBcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBkZWFkbGluZTogdGhpcy5nZXREZWFkbGluZSgpXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBnZXRBY2NvdW50KFxuICAgIHJlcTogSUdldEFjY291bnRSZXF1ZXN0XG4gICk6IFByb21pc2U8SUdldEFjY291bnRSZXNwb25zZT4ge1xuICAgIGNvbnN0IHBiUmVxID0gR2V0QWNjb3VudFJlcXVlc3QudG8ocmVxKTtcbiAgICBjb25zdCBwYlJlc3AgPSBhd2FpdCB0aGlzLmNsaWVudC5nZXRBY2NvdW50KHBiUmVxLCB0aGlzLmdldE1ldGFkYXRhKCkpO1xuICAgIHJldHVybiBHZXRBY2NvdW50UmVxdWVzdC5mcm9tKHBiUmVzcCk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2V0QmxvY2tNZXRhcyhcbiAgICByZXE6IElHZXRCbG9ja01ldGFzUmVxdWVzdFxuICApOiBQcm9taXNlPElHZXRCbG9ja01ldGFzUmVzcG9uc2U+IHtcbiAgICBjb25zdCBwYlJlcSA9IEdldEJsb2NrTWV0YXNSZXF1ZXN0LnRvKHJlcSk7XG4gICAgY29uc3QgcGJSZXNwID0gYXdhaXQgdGhpcy5jbGllbnQuZ2V0QmxvY2tNZXRhcyhwYlJlcSwgdGhpcy5nZXRNZXRhZGF0YSgpKTtcbiAgICByZXR1cm4gR2V0QmxvY2tNZXRhc1JlcXVlc3QuZnJvbShwYlJlc3ApO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGdldENoYWluTWV0YShcbiAgICByZXE6IElHZXRDaGFpbk1ldGFSZXF1ZXN0XG4gICk6IFByb21pc2U8SUdldENoYWluTWV0YVJlc3BvbnNlPiB7XG4gICAgY29uc3QgcGJSZXEgPSBHZXRDaGFpbk1ldGFSZXF1ZXN0LnRvKHJlcSk7XG4gICAgY29uc3QgcGJSZXNwID0gYXdhaXQgdGhpcy5jbGllbnQuZ2V0Q2hhaW5NZXRhKHBiUmVxLCB0aGlzLmdldE1ldGFkYXRhKCkpO1xuICAgIHJldHVybiBHZXRDaGFpbk1ldGFSZXF1ZXN0LmZyb20ocGJSZXNwKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBnZXRTZXJ2ZXJNZXRhKFxuICAgIHJlcTogSUdldFNlcnZlck1ldGFSZXF1ZXN0XG4gICk6IFByb21pc2U8SUdldFNlcnZlck1ldGFSZXNwb25zZT4ge1xuICAgIGNvbnN0IHBiUmVxID0gR2V0U2VydmVyTWV0YVJlcXVlc3QudG8ocmVxKTtcbiAgICBjb25zdCBwYlJlc3AgPSBhd2FpdCB0aGlzLmNsaWVudC5nZXRTZXJ2ZXJNZXRhKHBiUmVxLCB0aGlzLmdldE1ldGFkYXRhKCkpO1xuICAgIHJldHVybiBHZXRTZXJ2ZXJNZXRhUmVxdWVzdC5mcm9tKHBiUmVzcCk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2V0QWN0aW9ucyhcbiAgICByZXE6IElHZXRBY3Rpb25zUmVxdWVzdFxuICApOiBQcm9taXNlPElHZXRBY3Rpb25zUmVzcG9uc2U+IHtcbiAgICBjb25zdCBwYlJlcSA9IEdldEFjdGlvbnNSZXF1ZXN0LnRvKHJlcSk7XG4gICAgY29uc3QgcGJSZXNwID0gYXdhaXQgdGhpcy5jbGllbnQuZ2V0QWN0aW9ucyhwYlJlcSwgdGhpcy5nZXRNZXRhZGF0YSgpKTtcbiAgICByZXR1cm4gR2V0QWN0aW9uc1JlcXVlc3QuZnJvbShwYlJlc3ApO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIHN1Z2dlc3RHYXNQcmljZShcbiAgICByZXE6IElTdWdnZXN0R2FzUHJpY2VSZXF1ZXN0XG4gICk6IFByb21pc2U8SVN1Z2dlc3RHYXNQcmljZVJlc3BvbnNlPiB7XG4gICAgY29uc3QgcGJSZXEgPSBTdWdnZXN0R2FzUHJpY2VSZXF1ZXN0LnRvKHJlcSk7XG4gICAgY29uc3QgcGJSZXNwID0gYXdhaXQgdGhpcy5jbGllbnQuc3VnZ2VzdEdhc1ByaWNlKHBiUmVxLCB0aGlzLmdldE1ldGFkYXRhKCkpO1xuICAgIHJldHVybiBTdWdnZXN0R2FzUHJpY2VSZXF1ZXN0LmZyb20ocGJSZXNwKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBlc3RpbWF0ZUdhc0ZvckFjdGlvbihcbiAgICByZXE6IElFc3RpbWF0ZUdhc0ZvckFjdGlvblJlcXVlc3RcbiAgKTogUHJvbWlzZTxJRXN0aW1hdGVHYXNGb3JBY3Rpb25SZXNwb25zZT4ge1xuICAgIGNvbnN0IHBiUmVxID0gRXN0aW1hdGVHYXNGb3JBY3Rpb25SZXF1ZXN0LnRvKHJlcSk7XG4gICAgY29uc3QgcGJSZXNwID0gYXdhaXQgdGhpcy5jbGllbnQuZXN0aW1hdGVHYXNGb3JBY3Rpb24oXG4gICAgICBwYlJlcSxcbiAgICAgIHRoaXMuZ2V0TWV0YWRhdGEoKVxuICAgICk7XG4gICAgcmV0dXJuIEVzdGltYXRlR2FzRm9yQWN0aW9uUmVxdWVzdC5mcm9tKHBiUmVzcCk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgcmVhZFN0YXRlKHJlcTogSVJlYWRTdGF0ZVJlcXVlc3QpOiBQcm9taXNlPElSZWFkU3RhdGVSZXNwb25zZT4ge1xuICAgIGNvbnN0IHBiUmVxID0gUmVhZFN0YXRlUmVxdWVzdC50byhyZXEpO1xuICAgIGNvbnN0IHBiUmVzcCA9IGF3YWl0IHRoaXMuY2xpZW50LnJlYWRTdGF0ZShwYlJlcSwgdGhpcy5nZXRNZXRhZGF0YSgpKTtcbiAgICByZXR1cm4gUmVhZFN0YXRlUmVxdWVzdC5mcm9tKHBiUmVzcCk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgcmVhZENvbnRyYWN0KFxuICAgIHJlcTogSVJlYWRDb250cmFjdFJlcXVlc3RcbiAgKTogUHJvbWlzZTxJUmVhZENvbnRyYWN0UmVzcG9uc2U+IHtcbiAgICBjb25zdCBwYlJlcSA9IFJlYWRDb250cmFjdFJlcXVlc3QudG8ocmVxKTtcbiAgICBjb25zdCBwYlJlc3AgPSBhd2FpdCB0aGlzLmNsaWVudC5yZWFkQ29udHJhY3QocGJSZXEsIHRoaXMuZ2V0TWV0YWRhdGEoKSk7XG4gICAgcmV0dXJuIFJlYWRDb250cmFjdFJlcXVlc3QuZnJvbShwYlJlc3ApO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIHNlbmRBY3Rpb24oXG4gICAgcmVxOiBJU2VuZEFjdGlvblJlcXVlc3RcbiAgKTogUHJvbWlzZTxJU2VuZEFjdGlvblJlc3BvbnNlPiB7XG4gICAgY29uc3QgcGJSZXEgPSBTZW5kQWN0aW9uUmVxdWVzdC50byhyZXEpO1xuICAgIGNvbnN0IHBiUmVzcCA9IGF3YWl0IHRoaXMuY2xpZW50LnNlbmRBY3Rpb24ocGJSZXEsIHRoaXMuZ2V0TWV0YWRhdGEoKSk7XG4gICAgcmV0dXJuIFNlbmRBY3Rpb25SZXNwb25zZS5mcm9tKHBiUmVzcCk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2V0UmVjZWlwdEJ5QWN0aW9uKFxuICAgIHJlcTogSUdldFJlY2VpcHRCeUFjdGlvblJlcXVlc3RcbiAgKTogUHJvbWlzZTxJR2V0UmVjZWlwdEJ5QWN0aW9uUmVzcG9uc2U+IHtcbiAgICBjb25zdCBwYlJlcSA9IEdldFJlY2VpcHRCeUFjdGlvblJlcXVlc3QudG8ocmVxKTtcbiAgICBjb25zdCBwYlJlc3AgPSBhd2FpdCB0aGlzLmNsaWVudC5nZXRSZWNlaXB0QnlBY3Rpb24oXG4gICAgICBwYlJlcSxcbiAgICAgIHRoaXMuZ2V0TWV0YWRhdGEoKVxuICAgICk7XG4gICAgcmV0dXJuIEdldFJlY2VpcHRCeUFjdGlvblJlcXVlc3QuZnJvbShwYlJlc3ApO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGdldEVwb2NoTWV0YShcbiAgICByZXE6IElHZXRFcG9jaE1ldGFSZXF1ZXN0XG4gICk6IFByb21pc2U8SUdldEVwb2NoTWV0YVJlc3BvbnNlPiB7XG4gICAgY29uc3QgcGJSZXEgPSBHZXRFcG9jaE1ldGFSZXF1ZXN0LnRvKHJlcSk7XG4gICAgY29uc3QgcGJSZXNwID0gYXdhaXQgdGhpcy5jbGllbnQuZ2V0RXBvY2hNZXRhKHBiUmVxLCB0aGlzLmdldE1ldGFkYXRhKCkpO1xuICAgIHJldHVybiBHZXRFcG9jaE1ldGFSZXF1ZXN0LmZyb20ocGJSZXNwKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBnZXRMb2dzKHJlcTogSUdldExvZ3NSZXF1ZXN0KTogUHJvbWlzZTxJR2V0TG9nc1Jlc3BvbnNlPiB7XG4gICAgY29uc3QgcGJSZXEgPSBHZXRMb2dzUmVxdWVzdC50byhyZXEpO1xuICAgIGNvbnN0IHBiUmVzcCA9IGF3YWl0IHRoaXMuY2xpZW50LmdldExvZ3MocGJSZXEsIHRoaXMuZ2V0TWV0YWRhdGEoKSk7XG4gICAgcmV0dXJuIEdldExvZ3NSZXF1ZXN0LmZyb20ocGJSZXNwKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBlc3RpbWF0ZUFjdGlvbkdhc0NvbnN1bXB0aW9uKFxuICAgIHJlcTogSUVzdGltYXRlQWN0aW9uR2FzQ29uc3VtcHRpb25SZXF1ZXN0XG4gICk6IFByb21pc2U8SUVzdGltYXRlQWN0aW9uR2FzQ29uc3VtcHRpb25SZXNwb25zZT4ge1xuICAgIGNvbnN0IHBiUmVxID0gRXN0aW1hdGVBY3Rpb25HYXNDb25zdW1wdGlvblJlcXVlc3QudG8ocmVxKTtcbiAgICBjb25zdCBwYlJlc3AgPSBhd2FpdCB0aGlzLmNsaWVudC5lc3RpbWF0ZUFjdGlvbkdhc0NvbnN1bXB0aW9uKFxuICAgICAgcGJSZXEsXG4gICAgICB0aGlzLmdldE1ldGFkYXRhKClcbiAgICApO1xuICAgIHJldHVybiBFc3RpbWF0ZUFjdGlvbkdhc0NvbnN1bXB0aW9uUmVxdWVzdC5mcm9tKHBiUmVzcCk7XG4gIH1cblxuICBwdWJsaWMgc3RyZWFtQmxvY2tzKFxuICAgIHJlcTogSVN0cmVhbUJsb2Nrc1JlcXVlc3RcbiAgKTogQ2xpZW50UmVhZGFibGVTdHJlYW08SVN0cmVhbUJsb2Nrc1Jlc3BvbnNlPiB7XG4gICAgY29uc3QgcGJSZXEgPSBTdHJlYW1CbG9ja3NSZXF1ZXN0LnRvKHJlcSk7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNvbnN0IG9yaWdpbiA9IHRoaXMuY2xpZW50LnN0cmVhbUJsb2NrcyhwYlJlcSwgdGhpcy5nZXRNZXRhZGF0YSgpKTtcblxuICAgIHJldHVybiBuZXcgQ2xpZW50UmVhZGFibGVTdHJlYW0ob3JpZ2luLCBcIlN0cmVhbUJsb2Nrc1wiKTtcbiAgfVxuXG4gIHB1YmxpYyBzdHJlYW1Mb2dzKFxuICAgIHJlcTogSVN0cmVhbUxvZ3NSZXF1ZXN0XG4gICk6IENsaWVudFJlYWRhYmxlU3RyZWFtPElTdHJlYW1Mb2dzUmVzcG9uc2U+IHtcbiAgICBjb25zdCBwYlJlcSA9IFN0cmVhbUxvZ3NSZXF1ZXN0LnRvKHJlcSk7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNvbnN0IG9yaWdpbiA9IHRoaXMuY2xpZW50LnN0cmVhbUxvZ3MocGJSZXEsIHRoaXMuZ2V0TWV0YWRhdGEoKSk7XG5cbiAgICByZXR1cm4gbmV3IENsaWVudFJlYWRhYmxlU3RyZWFtKG9yaWdpbiwgXCJTdHJlYW1Mb2dzXCIpO1xuICB9XG59XG4iXX0=